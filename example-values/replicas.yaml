# This file controls the replicaCount and autoscaling policies of all fusion components
# For all components that can easily be run with multiple instances we set the initial
# replicas to 2, apart from solr and zookeeper that are set with 3.
# Autoscaling policies are enabled for all components that support them, to a
# basic CPU based scaling metric. Other metrics can be enabled, see:
# https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#support-for-custom-metrics

admin-ui:
  replicaCount: 0

api-gateway:
  replicaCount: 0
  autoscaling:
    enabled: true
    maxReplicas: 4
    metrics:
    - type: Resource
      resource:
        name: cpu
        targetAverageUtilization: 70

auth-ui:
  replicaCount: 0

classic-rest-service:
  replicaCount: 0

devops-ui:
  replicaCount: 0

fusion-admin:
  replicaCount: 0

fusion-indexing:
  replicaCount: 0
  autoscaling:
    enabled: true
    maxReplicas: 4
    metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 70

insights:
  replicaCount: 0
  autoscaling:
    enabled: false
    maxReplicas: 3
    metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 70

job-launcher:
  replicaCount: 0

job-rest-server:
  replicaCount: 0
  autoscaling:
    enabled: false
    maxReplicas: 3
    metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 70

ml-model-service:
  replicaCount: 0
  autoscaling:
    enabled: true
    maxReplicas: 6
    metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 70

query-pipeline:
  replicaCount: 0
  autoscaling:
    enabled: true
    maxReplicas: 6
    metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 60

rest-service:
  replicaCount: 0
  autoscaling:
    enabled: false
    maxReplicas: 3
    metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 70

rpc-service:
  replicaCount: 0
  plugins:
    # Number of replicas of each plugin service.
    # WARN this setting is global and will affect all plugins.
    # This setting only affect new plugins deployments.
    # Scale them up/down manually if needed.
    # The replicas for plugins can be modified by modifying plugin.replicas in values.yaml file for rpc-connectors
    replicas: 0
  autoscaling:
    enabled: true
    maxReplicas: 4
    metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 70

rules-ui:
  replicaCount: 0

solr:
  replicaCount: 4

sql-service:
  replicaCount: 0

webapps:
  replicaCount: 0
  autoscaling:
    enabled: false
    maxReplicas: 3
    metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 70

zookeeper:
  replicaCount: 3

fusion-ambassador:
  replicaCount: 0

milvus-writable:
  replicaCount: 0

connector-plugin-service:
  # the base connector-plugin-service deployment must be 0
  replicaCount: 0

argo:
  replicaCount: 0

argo-common-workflows:
  replicaCount: 0

classification:
  replicaCount: 0
config-sync:
  replicaCount: 0
fusion-jupyter:
  replicaCount: 0
fusion-log-forwarder:
  replicaCount: 0
fusion-resources:
  replicaCount: 0
pm-ui:
  replicaCount: 0
pulsar:
  bookkeeper:
    replicaCount: 0
  broker:
    replicaCount: 0
question-answering:
  replicaCount: 0
recommender:
  replicaCount: 0
seldon-core-operator:
  replicaCount: 0
solr-backup-runner:
  replicaCount: 0
templating:
  replicaCount: 0
